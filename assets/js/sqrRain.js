// Generated by CoffeeScript 1.3.1

/*
	A canvas wallpaper.
	@Author: Jose Padilla
*/


(function() {
  var ANIMATION_SPEED, Draw, MAX_DROPS, Rain, TIMER_SPEED, Update, addDrop, anim, animation, blank, bufferCanvas, bufferContext, canvas, context, init, rainDropsArray, shape, stop, timer;

  $(function() {
    return init();
  });

  $(function() {
    return $('#canvaSquare').click(function() {
      stop();
    });
  });

  shape = canvas = context = bufferCanvas = bufferContext = timer = anim = null;

  rainDropsArray = [];

  MAX_DROPS = 50;

  TIMER_SPEED = 10;

  ANIMATION_SPEED = 5;

  /*
   Functions
  */


  init = function() {
    shape = document.getElementById('canvaSquare').dataset['shape'];
    canvas = document.getElementById('canvaSquare');
    context = canvas.getContext('2d');
    context.canvas.width = window.innerWidth;
    context.canvas.height = window.innerHeight;
    bufferCanvas = document.createElement('canvas');
    bufferContext = bufferCanvas.getContext('2d');
    bufferContext.canvas.width = context.canvas.width;
    bufferContext.canvas.height = context.canvas.height;
    timer = setInterval(addDrop, TIMER_SPEED);
    Draw(shape);
    anim = setInterval(animation, ANIMATION_SPEED);
  };

  Rain = function() {
    var RAIN_OPACITY, RAIN_SPEED_AMOUNT, RAIN_WIDTH;
    RAIN_SPEED_AMOUNT = 1.05;
    RAIN_OPACITY = 0.5;
    RAIN_WIDTH = 90;
    this.x = Math.round(Math.random() * canvas.width);
    this.y = Math.round(Math.random() * canvas.height);
    this.speed = Math.random() * RAIN_SPEED_AMOUNT;
    this.opacity = Math.random() * RAIN_OPACITY;
    this.width = (Math.random() * RAIN_WIDTH) + 1;
    this.height = this.width;
  };

  addDrop = function() {
    rainDropsArray[rainDropsArray.length] = new Rain();
    if (rainDropsArray.length === MAX_DROPS) {
      clearInterval(timer);
      clearInterval(anim);
    }
  };

  animation = function() {
    Update();
    Draw(shape);
  };

  blank = function() {
    bufferContext.fillStyle = '#edeef0';
    bufferContext.fillRect(0, 0, bufferContext.canvas.width, bufferContext.canvas.height);
  };

  Update = function() {
    var RAINDROPS_ARRAY_WIDTH, e, i, _i, _len;
    RAINDROPS_ARRAY_WIDTH = 1.001;
    for (i = _i = 0, _len = rainDropsArray.length; _i < _len; i = ++_i) {
      e = rainDropsArray[i];
      if (rainDropsArray[i].x <= canvas.width + rainDropsArray[i].width) {
        rainDropsArray[i].width += RAINDROPS_ARRAY_WIDTH;
        rainDropsArray[i].height = rainDropsArray[i].width;
      } else {
        rainDropsArray[i].x = -1 * rainDropsArray[i].width;
      }
    }
  };

  Draw = function(s) {
    var LINE_WIDTH, e, i, _i, _j, _len, _len1;
    context.save();
    blank();
    if (s === 'circle') {
      LINE_WIDTH = 0.5;
      for (i = _i = 0, _len = rainDropsArray.length; _i < _len; i = ++_i) {
        e = rainDropsArray[i];
        bufferContext.beginPath();
        bufferContext.arc(rainDropsArray[i].x, rainDropsArray[i].y, rainDropsArray[i].width / 2, 0, 2 * Math.PI, false);
        bufferContext.fillStyle = "rgba(77,77,77," + rainDropsArray[i].opacity + ")";
        bufferContext.fill();
        bufferContext.lineWidth = LINE_WIDTH;
        bufferContext.strokeStyle = 'rgba(60,50,103,0.5)';
        bufferContext.stroke();
      }
      context.drawImage(bufferCanvas, 0, 0, bufferCanvas.width, bufferCanvas.height);
      context.restore();
    }
    if (s === 'square') {
      for (i = _j = 0, _len1 = rainDropsArray.length; _j < _len1; i = ++_j) {
        e = rainDropsArray[i];
        bufferContext.fillStyle = "rgba(77,77,77," + rainDropsArray[i].opacity + ")";
        bufferContext.fillRect(rainDropsArray[i].x, rainDropsArray[i].y, rainDropsArray[i].width, rainDropsArray[i].height);
      }
      context.drawImage(bufferCanvas, 0, 0, bufferCanvas.width, bufferCanvas.height);
      context.restore();
    }
  };

  stop = function() {
    clearInterval(timer);
    clearInterval(addDrop);
    clearInterval(anim);
  };

}).call(this);
